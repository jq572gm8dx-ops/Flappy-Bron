<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Flappy Bron Pixel Edition</title>
<style>
body {
    background-color: #303030;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
    font-family: 'Press Start 2P', 'Consolas', monospace;
    color: #eee;
    text-shadow: 2px 2px #000;
}

/* Canvas styling unchanged for pixel look */
canvas {
    border: 4px solid #555;
    background-image:url(Gemini_Generated_Image_x51mbwx51mbwx51m.png);
    background-size:cover;
    background-repeat: no-repeat;
    image-rendering: optimizeSpeed;
    image-rendering: -moz-crisp-edges;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: optimize-contrast;
    image-rendering: crisp-edges;
    image-rendering: pixelated;
    display: block;
    margin: 20px auto;
    box-sizing: border-box;
    width: 100vw;
    max-width: 100vw;
    height: auto;
    max-height: calc(100vh - 40px);
    margin: 20px auto;
    overflow: hidden;
    max-width: 480px;
    height: auto;
    cursor: pointer;
    touch-action: manipulation;
    transition: width .12s ease, height .12s ease, transform .12s ease;
    --fs-width: 100vw;
    --fs-height: 100vh;
    box-shadow: 8px 8px 0px 0px #1a1a1a;
    max-width: 120vw;
    height: auto;
    border-radius: 0;
}

/* Menu styling unchanged */
#menu {
    margin: 0;
    background-image: url("Untitled design.png");
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    margin: 0;
    padding: 30px 40px;
    border-radius: 0;
    box-shadow: 8px 8px 0px 0px #1a1a1a;
    border: 4px solid #555;
    text-transform: uppercase;
padding-top:300px;
}
/* --- Difficulty label and selector pixel style --- */
#menu label[for="difficulty"] {
    font-family: 'Press Start 2P', 'Consolas', monospace;
    text-shadow: 2px 2px #000;
    color: #FFD700;
    background: #222;
    border: 2px solid #555;
    box-shadow: 4px 4px 0px 0px #1a1a1a;
    padding: 12px 24px;
    border-radius: 0;
    margin-bottom: 12px;
    font-size: 1.1rem;
    display: block;
    letter-spacing: 2px;
    margin-top: 0;
    margin-left: 0;
}

#difficulty {
    font-family: 'Press Start 2P', 'Consolas', monospace;
    color: #FFD700;
    background: #222;
    border: 2px solid #555;
    box-shadow: 4px 4px 0px 0px #1a1a1a;
    padding: 12px 24px;
    border-radius: 0;
    margin-bottom: 24px;
    font-size: 1.1rem;
    outline: none;
    text-transform: uppercase;
    cursor: pointer;
    appearance: none;
margin-top:60px;
}
#difficulty:focus {
    border-color: #FFD700;
}

/* Continue with your usual menu headings, buttons, pixel art etc... */
#menu h1 {
    font-size: 3rem;
    color: #00FF00;
    margin-bottom: 20px;
    text-shadow: 4px 4px #000;
    line-height: 1;
}

#highText {
    font-size: 1.4rem;
    color: #FFD700;
    margin-top: 70px;
    margin-bottom: 40px;
    font-weight: normal;
    text-shadow: 2px 2px #000;
}
button {
    padding: 0;
    border-radius: 0;
    border: none;
    background: transparent;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 200px;
    height: 200px;
    line-height: 1;
    position: relative;
    outline: none;
    padding-top:360px;
}
button:active::before {
    box-shadow: 0px 0px 0px 0px #000;
    transform: translate(4px, 4px);
}
#startBtn svg {
    width: 100px;
    height: 100px;
    fill: none;
    display: block;
    position: relative;
    z-index: 1;
}

/* Message Box styling unchanged, except appear above pixel menu */
.message-box {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #222;
    padding: 30px;
    border-radius: 0;
    box-shadow: 8px 8px 0px 0px #1a1a1a;
    text-align: center;
    z-index: 1000;
    border: 4px solid #FF0000;
    display: none;
    text-transform: uppercase;
}
.message-box h3 {
    color: #FF0000;
    font-size: 2rem;
    margin-bottom: 15px;
    text-shadow: 2px 2px #000;
}
.message-box p {
    color: #eee;
    font-size: 1.1rem;
    margin-bottom: 25px;
    text-shadow: 1px 1px #000;
}
.message-box button {
    margin-top: 0;
    width: auto;
    height: auto;
    padding: 10px 20px;
    font-size: 1.2rem;
    color: white;
    background: #FF0000;
    border: 2px solid #a30000;
    box-shadow: 4px 4px 0px 0px #000;
    text-shadow: 1px 1px #000;
}
.message-box button::before {display: none;}
.message-box button:active {
    box-shadow: 0px 0px 0px 0px #000;
    transform: translate(4px, 4px);
}
</style>
</head>
<body>

<div id="menu">
 <h2 id="highText">High Score: <b>0</b></h2>
   <button id="startBtn">
       <img style="width:100px;height: auto;" src="start.jpg" alt="">
    </button>
    <!-- Difficulty dropdown with pixel styling -->
   
    <select id="difficulty">
      <option value="easy">Easy</option>
      <option value="normal" selected>Normal</option>
      <option value="hard">Hard</option>
    </select>
    <h2 id="highText">High Score: <b>0</b></h2>
 
</div>

<div id="messageBox" class="message-box">
    <h3 id="messageTitle">GAME OVER!</h3>
    <p id="messageBody"></p>
    <button id="messageCloseBtn">OK</button>
</div>

<script>
var myGamePiece;
var highScore = 0;
var gameRunning = false;
var myObstacles = [];
var myScore;

var selectedDifficulty = 'normal'; // Default difficulty

// --- Difficulty selection listener ---
document.getElementById('difficulty').addEventListener('change', function(e){
    selectedDifficulty = e.target.value;
});

// --- Utility Functions ---

function showMessage(title, body) {
    document.getElementById('messageTitle').innerText = title;
    document.getElementById('messageBody').innerHTML = body;
    document.getElementById('messageBox').style.display = 'block';

    document.getElementById('menu').style.pointerEvents = 'none';
    if (myGameArea.canvas.parentNode) {
        myGameArea.canvas.style.pointerEvents = 'none';
    }
}

function hideMessage() {
    document.getElementById('messageBox').style.display = 'none';
    document.getElementById('menu').style.pointerEvents = 'auto';
    if (myGameArea.canvas.parentNode) {
        myGameArea.canvas.style.pointerEvents = 'auto';
    }
}

document.getElementById('messageCloseBtn').addEventListener('click', hideMessage);

// --- Game Initialization and Flow ---

function startGameFromMenu() {
    hideMessage();
    document.getElementById("menu").style.display = "none";
    startGame();
}

function startGame() {
    gameRunning = true;
    myObstacles = [];

    // Dummy SVG string as placeholder
    const playerSvgData = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0...";
    myGamePiece = new component(40, 30, playerSvgData, 10, 120, "image");
    myGamePiece.gravity = 0.15;

    myScore = new component("30px", "Press Start 2P", "black", 280, 40, "text");
    myGameArea.start();
}

var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = 480;
        this.canvas.height = 270;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.getElementById('menu'));
        this.frameNo = 0;
        this.interval = setInterval(updateGameArea, 20);
    },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    },
    stop : function() {
        clearInterval(this.interval);
    }
}

// --- Game Components ---
function component(width, height, colorOrImgSrc, x, y, type) {
    this.type = type;
    this.score = 0;
    this.width = width;
    this.height = height;
    this.speedX = 0;
    this.speedY = 0;
    this.x = x;
    this.y = y;
    this.gravity = 0;
    this.gravitySpeed = 0;

    if (this.type === 'image') {
        this.img = new Image();
        this.img.src = colorOrImgSrc;
        this.loaded = false;
        this.img.onload = () => {
            this.loaded = true;
        };
        this.color = "#964B00";
    } else {
        this.color = colorOrImgSrc;
    }
    this.update = function() {
        var ctx = myGameArea.context;
        if (this.type === "text") {
            ctx.font = this.width + " " + this.height;
            ctx.fillStyle = this.color;
            ctx.fillText(this.text, this.x, this.y);
        } else if (this.type === "image" && this.loaded) {
            ctx.save();
            const rotationDegree = Math.min(Math.max(this.gravitySpeed * 10, -30), 45);
            ctx.translate(this.x + this.width / 2, this.y + this.height / 2);
            ctx.rotate(rotationDegree * Math.PI / 180);
            ctx.drawImage(this.img, -this.width / 2, -this.height / 2, this.width, this.height);
            ctx.restore();
        } else {
            ctx.fillStyle = this.color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
    }
    this.newPos = function() {
        this.gravitySpeed += this.gravity;
        this.x += this.speedX;
        this.y += this.speedY + this.gravitySpeed;
        this.hitBottom();
        this.hitTop();
    }
    this.hitBottom = function() {
        var rockbottom = myGameArea.canvas.height - this.height;
        if (this.y > rockbottom) {
            this.y = rockbottom;
            this.gravitySpeed = 0;
        }
    }
    this.hitTop = function() {
        if (this.y < 0) {
            this.y = 0;
            this.gravitySpeed = 0;
        }
    }
    this.crashWith = function(otherobj) {
        var myleft = this.x;
        var myright = this.x + this.width;
        var mytop = this.y;
        var mybottom = this.y + this.height;
        var otherleft = otherobj.x;
        var otherright = otherobj.x + otherobj.width;
        var othertop = otherobj.y;
        var otherbottom = otherobj.y + otherobj.height;
        return !(mybottom < othertop || mytop > otherbottom || myright < otherleft || myleft > otherright);
    }
}

// --- Difficulty-based speed scaling ---
function getObstacleSpeed(score) {
    if (selectedDifficulty === 'easy') {
        return -2 - score * 0.025;
    } else if (selectedDifficulty === 'normal') {
        return -2.5 - score * 0.035;
    } else if (selectedDifficulty === 'hard') {
        return -3 - score * 0.055;
    } else {
        return -2.5 - score * 0.035;
    }
}

function updateGameArea() {
    if (!gameRunning) return;

    for (var i = 0; i < myObstacles.length; i++) {
        if (myGamePiece.crashWith(myObstacles[i])) {
            endGame();
            return;
        }
    }

    myGameArea.clear();
    myGameArea.frameNo += 1;

    let currentScore = Math.floor(myGameArea.frameNo / 5);

    var obstacleSpeed = getObstacleSpeed(currentScore);

    if (myGameArea.frameNo == 1 || everyinterval(150)) {
        var x = myGameArea.canvas.width;
        var minHeight = 20, maxHeight = 180;
        var height = Math.floor(Math.random() * (maxHeight - minHeight + 1) + minHeight);
        var minGap = 80, maxGap = 120;
        var gap = Math.floor(Math.random() * (maxGap - minGap + 1) + minGap);

        myObstacles.push(new component(20, height, "#2e7d32", x, 0));
        myObstacles.push(new component(20, x - height - gap, "#2e7d32", x, height + gap));
    }

    for (var i = 0; i < myObstacles.length; i++) {
        myObstacles[i].x += obstacleSpeed;
        myObstacles[i].update();
    }

    myScore.text = "SCORE: " + Math.floor(myGameArea.frameNo / 10);
    myScore.update();

    myGamePiece.newPos();
    myGamePiece.update();
}

function endGame() {
    gameRunning = false;
    myGameArea.stop();

    const finalScore = Math.floor(myGameArea.frameNo / 10);
    let message = `YOUR SCORE: <b>${finalScore}</b>!`;

    if (finalScore > highScore) {
        highScore = finalScore;
        document.getElementById("highText").innerHTML = "HIGH SCORE: <b>" + highScore + "</b>";
        message += "<br>NEW HIGH SCORE!";
        try { localStorage.setItem('lb_highscore', highScore); } catch(e) { console.error("Local storage error:", e); }
    } else {
        document.getElementById("highText").innerHTML = "HIGH SCORE: <b>" + highScore + "</b>";
    }

    showMessage("YOU GOT DUNKED ON!", message);

    if (myGameArea.canvas && myGameArea.canvas.parentNode) {
        myGameArea.canvas.parentNode.removeChild(myGameArea.canvas);
    }
    document.getElementById("menu").style.display = "block";
}

function everyinterval(n) {
    return (myGameArea.frameNo / n) % 1 === 0;
}

function jump() {
    let currentScore = Math.floor(myGameArea.frameNo / 5);
    if (gameRunning && myGamePiece) {
        myGamePiece.gravitySpeed = -3.2 - currentScore * 0.001;
    }
}

// --- Input Handlers ---
document.addEventListener('keydown', function(e) {
    if (e.code === 'Space') {
        e.preventDefault();
        jump();
    }
});
document.addEventListener('mousedown', function(e) {
    if (gameRunning) {
        e.preventDefault();
        jump();
    }
});
document.addEventListener('touchstart', function(e) {
    if (gameRunning) {
        e.preventDefault();
        jump();
    }
}, {passive:false});

// --- Initial Setup (Load High Score) ---
document.addEventListener('DOMContentLoaded', function() {
    var btn = document.getElementById('startBtn');
    if (btn) {
        btn.addEventListener('click', startGameFromMenu);
        btn.addEventListener('touchstart', function(e){ e.preventDefault(); startGameFromMenu(); }, {passive:false});
    }

    try {
        var saved = parseInt(localStorage.getItem('lb_highscore')) || 0;
        if (saved > 0) {
            highScore = saved;
            document.getElementById('highText').innerHTML = 'HIGH SCORE: <b>' + highScore + '</b>';
        }
    } catch(e) {
        console.warn("Could not access localStorage for high score.");
    }
});

</script>
</body>
</html>
